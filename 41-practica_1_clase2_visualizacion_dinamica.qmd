# Visualizaci√≥n y Mapas Din√°micos {#sec-viz}

## Introducci√≥n

En la Geom√°tica moderna, la capacidad de comunicar resultados mediante mapas interactivos y salidas gr√°ficas de alta calidad es fundamental. Gracias a iniciativas como **OpenGeos** y el ecosistema de **R-Spatial**, hoy podemos generar productos cartogr√°ficos profesionales con muy pocas l√≠neas de c√≥digo.

## Visualizaci√≥n Interactiva (Web Maps)

Los mapas din√°micos permiten explorar datos espaciales con zoom y desplazamiento, facilitando la validaci√≥n de informaci√≥n en tiempo real.

::: {.panel-tabset}

### üêç Python (Leafmap & Geemap)

En Python, utilizamos `leafmap` para datos vectoriales y `geemap` para el procesamiento masivo en la nube con Google Earth Engine.

Documentaci√≥n de `leafmap` [aqu√≠!](https://github.com/opengeos/leafmap)


```{python}
#| label: leafmap_python
#| eval: false
import leafmap

# 1. Crear el objeto mapa centrado en el Ecuador con zoom global
# Leafmap permite usar diversos mapas base por defecto
m = leafmap.Map(center=[0, 0], zoom=2)

# 2. Definir la ruta del archivo GeoJSON (Cables submarinos)
# Se utiliza una URL de release para mayor compatibilidad con los drivers GDAL
in_geojson = (
    "https://github.com/opengeos/datasets/releases/download/vector/cables.geojson"
)

# 3. A√±adir la capa al mapa con un nombre espec√≠fico
# Este m√©todo lee el archivo remoto y lo renderiza sobre el mapa base
m.add_geojson(in_geojson, layer_name="L√≠neas de Cable")

# 4. Mostrar el mapa interactivo
m
```

Documentaci√≥n de `geemap` [aqu√≠!](https://github.com/gee-community/geemap)


```{python}
#| label: geemap_python
#| eval: false
import geemap

# 1. Crear el mapa centrado en un punto (Bogot√°) para evitar errores de geometr√≠a
m = geemap.Map(center=[4.63, -74.08], zoom=10)

# 2. Cargar colecci√≥n Sentinel-2 Armonizada (ID corArecto para 2024)
collection = (
    geemap.ee.ImageCollection('COPERNICUS/S2_SR_HARMONIZED')
    .filterDate('2024-01-01', '2024-03-31')
    .median()
)

# 3. Par√°metros de visualizaci√≥n simples
vis_params = {'min': 0, 'max': 3000, 'bands': ['B4', 'B3', 'B2']}

# 4. A√±adir capa y mostrar
m.addLayer(collection, vis_params, 'Sentinel-2 UNAL')
m
```


### üèÅ R (Mapview)

En R, `mapview` ofrece una soluci√≥n de una sola l√≠nea para visualizar objetos espaciales de forma interactiva.

Documentaci√≥n sobre `mapview` [aqu√≠!](https://r-spatial.github.io/mapview/)

```{r}
#| label: mapview_r
#| eval: false
library(sf)
library(mapview)

# 1. Crear punto de referencia UNAL Bogot√° (EPSG:4326)
unal <- st_sfc(st_point(c(-74.08, 4.63)), crs = 4326)

# 2. Visualizaci√≥n interactiva inmediata
# Genera autom√°ticamente controles de capas y mapas base
mapview(unal, col.regions = "red", layer.name = "Sede Bogot√°")
```

:::



## Visualizaci√≥n Est√°tica (Mapas para Publicaci√≥n)

Para reportes profesionales o art√≠culos cient√≠ficos, se requiere un control total sobre la est√©tica, escalas y grillas.

::: {.panel-tabset}

### üêç Python (Geopandas + Matplotlib)

`Geopandas` es una herramienta que une el an√°lisis de datos tradicional en python (`pandas`) con la cartograf√≠a, permiti√©ndote manipular formas geom√©tricas con la misma facilidad con la que manipulas columnas en una hoja de Excel. Geopandas usa por debajo la librer√≠a `matplotlib` para hacer los mapas est√°ticos y `leaflet` para los din√°micos.

Documentaci√≥n sobre `geopandas` [aqu√≠!](https://geopandas.org/en/stable/)

```{python}
#| label: geopandas_python
#| eval: false
# Instala la librer√≠a geodatasets.
#!pip3 install geodatasets

# Importa geopandas y geodatasets.
import geopandas
from geodatasets import get_path

# Obtiene la ruta del dataset:
# "nybb" (New York Borough Boundaries).
path_to_data = get_path("nybb")

# Lee el archivo y lo convierte 
# en un GeoDataFrame
gdf = geopandas.read_file(path_to_data)

# Muestra la tabla.
gdf

# --- Visualizaci√≥n Est√°tica ---
# Genera un mapa fijo usando Matplotlib, coloreando por el nombre del distrito.
# Se incluye una leyenda para identificar cada color con su respectivo 'Borough'.
gdf.plot("BoroName", legend=True)

# --- Visualizaci√≥n Din√°mica ---
# Crea un mapa interactivo basado en Leaflet.
# El mapa base se carga autom√°ticamente.
gdf.explore("BoroName", legend=False)
```

### üèÅ R (Tmap & Ggplot2)

`tmap` permite una gram√°tica puramente cartogr√°fica, mientras que `ggplot2` integra el mapa en flujos de trabajo estad√≠sticos.

Documentaci√≥n sobre `tmap` [aqu√≠!](https://r-tmap.github.io/tmap/)


Documentaci√≥n sobre `ggplot2` + `sf` [aqu√≠!](https://ggplot2.tidyverse.org/reference/ggsf.html)


```{r}
#| label: tmap_ggplot2_r
# #| eval: false
library(sf)
library(tmap)
library(ggplot2)

# --- Usando tmap (Ideal para cartograf√≠a tem√°tica) ---
data("World")
col <- World[World$name == "Colombia", ]

tm_shape(col) +
  tm_polygons("pop_est", palette = "Blues", title = "Poblaci√≥n Est.") +
  tm_compass(position = c("right", "top")) +
  tm_scale_bar()

# --- Usando ggplot2 (Gram√°tica de gr√°ficos) ---
ggplot() +
  geom_sf(data = col, fill = "orange", color = "black") +
  theme_minimal() +
  labs(title = "Mapa de Colombia con ggplot2")
```

:::

---

### Notas de Reproducibilidad

* **Persistencia**: Recuerde trabajar siempre dentro de `/home/rstudio/work` para que sus scripts no se borren al reiniciar el contenedor.
* **Red**: La visualizaci√≥n de capas remotas requiere conexi√≥n a internet estable dentro del entorno Docker.
* **Motores**: Todo el renderizado depende de las librer√≠as de sistema GDAL, GEOS y PROJ preinstaladas.

::: {.callout-note}
### Ejercicio
Intente cargar un archivo vectorial local desde su carpeta de trabajo y visual√≠celo usando `mapview` en R o `m.add_gdf()` en Python.
:::


## üèÅ Desaf√≠o de Laboratorio: Visualizaci√≥n Geoespacial

Este laboratorio busca consolidar el manejo de las herramientas de Jupyter Lab y VSCode usando lenguaje Quarto. Adicionalmente es una introducci√≥n r√°pica a la creaci√≥n de mapas est√°ticos y din√°micos y su exportaci√≥n a formato HTML. La geom√°tica es la ciencia de gestionar informaci√≥n geogr√°fica mediante mapas digitales y an√°lisis de datos. Si hay una frase que describe a la geom√°tica, es la creaci√≥n y an√°lisis de mapas digitales. El objetivo es que el estudiante valide el funcionamiento de algunos de los entornos de trabajo instalados.

---

### üõ†Ô∏è Instrucciones de Entrega

1.  Creen un nuevo repositorio en su **GitHub personal** llamado `taller1-sig-visualizacion`.
2.  Todas las respuestas escritas deben estar en un archivo `respuestas.qmd`.
3.  Rendericen `respuestas.qmd` a **HTML** y **PDF**.
4.  Suban al repositorio los **4 notebooks** solicitados y los archivos de Quarto.

---

### ‚öôÔ∏è Parte A ‚Äî Notebooks de Clase (Reproducibilidad)

Creen cuatro notebooks donde ejecuten **exactamente** el c√≥digo desarrollado en clase. Esto asegura que su entorno (Docker/Jupyter) est√° correctamente configurado.

#### üìí Notebooks Obligatorios:

1.  **`01_python_estatico.ipynb`**: C√≥digo de `geopandas` + `geodatasets` para graficar los distritos de Nueva York (`nybb`) usando `.plot()`.
2.  **`02_python_dinamico.ipynb`**: C√≥digo de `leafmap` cargando el GeoJSON de cables submarinos y el c√≥digo de `geemap` con Sentinel-2 Armonizada.
3.  **`03_r_estatico.ipynb`**: C√≥digo de `sf` + `tmap` mostrando el mapa de poblaci√≥n de Colombia con br√∫jula y escala.
4.  **`04_r_dinamico.ipynb`**: C√≥digo de `mapview` mostrando el punto de la Sede Bogot√° con la configuraci√≥n para notebooks.

> Seguramente no podr√° visualizar algunos de esos resultados usando Notebooks, como alternativa tiene VSCode y los archivos Quarto (pero esto es opcional)
---

### üñ•Ô∏è Parte B ‚Äî Desaf√≠o de Exploraci√≥n

En su archivo `respuestas.qmd`, elijan **una** de las siguientes librer√≠as de Python (OpenGeos) y creen un nuevo bloque de c√≥digo que demuestre una funcionalidad **diferente** a la vista en clase, gui√°ndose por su documentaci√≥n oficial:

* **Leafmap**: Implementar un mapa de pantalla dividida (`split-panel`) o un inspector de atributos.
* **Geemap**: Cargar un dataset diferente (ej. elevaci√≥n SRTM o uso de suelo ESA WorldCover).
* **Mapwidget**: Crear un mapa utilizando un motor diferente como `Cesium` o `MapLibre`. [Documentaci√≥n](https://github.com/opengeos/mapwidget)
* **Anymap-ts**: [Documentaci√≥n.](https://github.com/opengeos/anymap-ts)
* **Anymap-ts**: [Documentaci√≥n.](https://github.com/opengeos/anymap)

---

### ‚ùì Preguntas de An√°lisis para `respuestas.qmd`

#### 1. ü•á Facilidad e Intuici√≥n
Basado en los 4 notebooks de clase: ¬øCu√°l de las librer√≠as les pareci√≥ m√°s intuitiva para un usuario que nunca ha programado?

#### 2. üé® Calidad Cartogr√°fica
Para la entrega de un informe t√©cnico en PDF, ¬øqu√© motor consideran que genera mapas est√°ticos con mejor acabado visual: `tmap`, `matplotlib` (`geopandas.plot`), `ggplot2`?

#### 3. üåê Potencial de la Documentaci√≥n
Al revisar las URL de documentaci√≥n entregadas, ¬øqu√© funcionalidad avanzada encontraron en el ecosistema de **OpenGeos** que les ser√≠a √∫til para su trabajo final o investigaci√≥n?

#### 4. üß† Elecci√≥n de Herramientas
Si tuvieran que atender una emergencia ambiental real y necesitan desplegar un visor web en menos de 5 minutos para que personal no t√©cnico visualice una inundaci√≥n, ¬øqu√© herramienta elegir√≠an y por qu√©? (M√°ximo 5 l√≠neas).

---

> üí° **Nota para el √©xito**
> 
> La precisi√≥n en la ruta de los datos y el manejo de los kernels es fundamental. Si un mapa din√°mico no carga, revise los mensajes de la consola de Quarto para descartar problemas de rutas de JavaScript. Y utilice IA para encontrar soluciones!